{%- comment %}

  Product Card
  ------------------------------------------------------------------------------

  Usage:

  {% include 'product-card',
              product: { product } - required
              lazy_load: { boolean } - optional, defaults to false,
  %}

{% endcomment -%}

{% comment %} Defaults {% endcomment %}
{% if lazy_load == blank %}
  {% assign lazy_load = false %}
{% endif %}
{% comment %} End Defaults {% endcomment %}

{% if product %}
  
  {% assign product_image_dimension = '1200x' %}
  {% assign product_url = product.url %}
  {% if collection %}
    {% assign product_url = product.url | within: collection %}
  {% endif %}

  <div id="product-card-{{ product.id }}" class="product-card" data-product-card>
    <div class="product-card__contents" data-product-card-contents>
      {% if product.featured_image %}
        <div class="product-card__gallery">
          <a href="{{ product_url }}">
            {% if lazy_load %}
              <div class="product-card__gallery-image" style="height: 0; padding-bottom: {{ product.featured_image.height | times: 100 | divided_by: product.featured_image.width | append: '%' }}" data-product-card-gallery>
                <img data-src="{{ product.featured_image.src | img_url: product_image_dimension }}" alt="{{ product.featured_image.alt | escape }}" data-product-card-main-lazy>
                <div class="product-card__gallery-placeholder"></div>
              </div>
            {% else %}
              <div class="product-card__gallery-image" data-product-card-gallery>
                <img src="{{ product.featured_image.src | img_url: product_image_dimension }}" alt="{{ product.featured_image.alt | escape }}">
              </div>
            {% endif %}
            {% if product.images.size > 1 %}
              {% assign alternate_image = product.images[1] %}
              {% comment %} Alt product image always gets lazy loaded {% endcomment %}
              <div class="product-card__gallery-image product-card__gallery-image--alt">
                <img data-src="{{ alternate_image.src | img_url: product_image_dimension }}" alt="{{ alternate_image.alt | escape }}" data-product-card-alt-lazy />
              </div>
            {% endif %}
          </a>
        </div>
      {% endif %}

      <div class="product-card__info">

        <h3 class="product-card__info-title">
          <a href="{{ product_url }}">{{ product.title }}</a>
        </h3>

        <div class="product-card__info-price">

          {% if product.compare_at_price > product.price %}
            <span class="visually-hidden">{{ 'products.product.regular_price' | t }}</span>
            <s>{{ product.compare_at_price | money }}</s>
          {% endif %}

          {% if product.price_varies %}
            {%- assign price = product.price | money -%}
            {{ 'products.product.from_text_html' | t: price: price }}
          {% else %}
            {{ product.price | money }}
          {% endif %}

          {% unless product.available %}
            {{ 'products.product.sold_out' | t }}
          {% endunless %}
        </div>
      </div>
    </div>

  </div>

{% endif %}
